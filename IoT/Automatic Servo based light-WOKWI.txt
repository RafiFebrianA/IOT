#define BLYNK_PRINT Serial
#define BLYNK_TEMPLATE_ID "TMPL68u4ssONh"
#define BLYNK_TEMPLATE_NAME "Otomatisasi Sistem Pencahayaan"
#define BLYNK_AUTH_TOKEN "4F1ncNsixiCCKZmM4x_kmXd39nD7KbZY"
#define VPIN_Saklar_1 V0
#define VPIN_Saklar_2 V1
#define VPIN_Semua_Saklar V2 
#define VPIN_Intensitas_Cahaya V3
#define ldrPin 4
#define servoapin 18
#define servobpin 19

#include <WiFi.h>
#include <WiFiClient.h>
#include <BlynkSimpleEsp32.h>
#include <ESP32_Servo.h>

char ssid[] = "YourNetworkName";
char pass[] = "YourPassword";

const float gama = 0.7;
const float rl10 = 50;

Servo servoa;
Servo servob;

bool servoaAtPosition180 = false;
bool servobAtPosition180 = false;

BLYNK_WRITE(V0)
{
int pinValue1=param.asInt()
if (pinValue1 == 1) {
	servoa.write(180);
	servoaAtPosition180 = true;
}
else {
servoa.write(0)
servoaAtPosition180 = false;
}

}

BLYNK_WRITE(V1)
{
int pinValue2=param.asInt()
if (pinValue2 == 1) {
	servob.write(180);
	servobAtPosition180 = true;
}
else {
servob.write(0)
servobAtPosition180 = false;
}

}

BLYNK_WRITE(V2)
{
int pinValue3=param.asInt()
if (pinValue3 == 1) {
	servoa.write(180);
	servob.write(180);
	servoaAtPosition180 = true;
	servobAtPosition180 = true;
}
else {
servoa.write(0)
servob.write(0)
servoaAtPosition180 = true;
servobAtPosition180 = false;
}

}

BLYNK_WRITE(V3)
{
Blynk.virtualWrite(V3, kecerahan);
}


void setup() {
  servoa.attach(servoapin);
  servob.attach(servobpin);
  Serial.begin(115200);
  Serial.println("Hello, ESP32!");
  Blynk.begin(auth, ssid, pass);
  delay(2000);
}

void loop() {
  int nilaiLDR = analogRead(ldrPin);
  nilaiLDR = map(nilaiLDR, 4095, 0, 1024, 0); // Mengubah nilai pembacaan sensor LDR dari nilai ADC Arduino menjadi nilai ADC ESP32
  float voltase = nilaiLDR / 1024.0 * 5;
  float resistansi = 2000 * voltase / (1 - voltase / 5);
  float kecerahan = pow(rl10 * 1e3 * pow(10, gama) / resistansi, 1 / gama);
  //Serial.print("Kecerahan = ");
  //Serial.println(kecerahan);
  Blynk.run();

--------------------------------------------------
  if (kecerahan >= 600) {
    if (!servoaAtPosition180) {
      servoa.write(180);
      servoaAtPosition180 = true;
    }
    if (!servobAtPosition180) {
      servob.write(180);
      servobAtPosition180 = true;
    }
  } else {
    if (servoaAtPosition180) {
      servoa.write(0);
      servoaAtPosition180 = false;
    }
    if (servobAtPosition180) {
      servob.write(0);
      servobAtPosition180 = false;
    }
  }
}
-------------------------------------------------
if (kecerahan >= 600) {
  if (!servoaAtPosition180) {
    servoa.write(180);
    servob.write(180);
    servoaAtPosition180 = true;
  }
} else {
  if (servoaAtPosition180) {
    servoa.write(0);
    servob.write(0);
    servoaAtPosition180 = false;
  }
}
--------------------------------------------------
